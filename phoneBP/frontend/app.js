var brojac = 0;
var e = 0

var phones =
  [
    {
      "_id": 222,
      "basicData": {
        "brend": "Apple",
        "model": "Iphone SE",
        "phoneImage": 'https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-se-2020.jpg',
        "price": 400
      },
      "characteristics": {
        "launch": {
          "announced": "2020, April 15",
          "realased": "Available. Released 2020, April 24"
        },
        "body": {
          "type": "Retina IPS LCD, 625 nits (typ)",
          "size": 4.7,
          "resolution": "750x1334",
          "protection": "Ion-strengthened glass, oleophobic coating"
        },
        "platform": {
          "OS": "iOS 13, upgradable to iOS 14",
          "Chipset": "Apple A13 Bionic (7 nm+)",
          "cpu": "Hexa-core (2x2.65 GHz Lightning + 4x1.8 GHz Thunder)",
          "gpu": "Apple GPU (4-core graphics)"
        },
        "memory": {
          "rom": [64, 128, 256],
          "ram": 3
        },
        "camera": {
          "MP": 12,
          "p": 2160
        },
        "battery": {
          "number": 2160,
          "material": "Li-on"
        }
      },
      "review": {
        "reviewText": [
          {
            "heading": "Iphone SE Review",
            "text": `Ah, the Apple iPhone SE. The Special Edition. Even if the Smaller Edition was more appropriate. And just
like the first iPhone SE, its second generation is both - Small, even if larger than the first one, and
Special - as such launch happens once in four years or so.We are sure Apple had plans for a great
premiere event last March, but COVID-19 turned everything upside down and such plans were abruptly
scrapped. The new iPhone was unveiled fanfare-less on the maker's website, out of the blue, but it
quickly became famous for being not only one of the cheapest iPhones ever made but also as one of the
season's hottest bang for the buck offers.Imagine that - bang for the buck coming from Apple! Indeed,
the highlight feature of the new iPhone SE is the A13 Bionic chip - that's Apple's latest platform - the
one that's powering the iPhone 11 trio. As for the rest, well, it's mostly iPhone 8.

Apple did use the 2.5 years old iPhone 8 as a canvas in more than one way. The shell is the same, as is
the screen (sans the 3D Touch layer), same front and rear cameras ergo photo and video capabilities,
same stereo speakers, same battery capacity, same charging capabilities.A thorough look reveals the
iPhone SE (2020) is indeed small by today's standards, and while it brings features introduced more than
two years ago, those are hardly outdated - the phone is water-resistant, its single camera offers
numerous features such as portraits, Smart HDR and even 4K at 60 with both OIS and EIS available, while
the stereo speakers are of an excellent quality that is tough to beat even to this very day.The bezels
are what looked old on the iPhone 8, and now they look ancient on this new SE model. They are wonderful
as thumb rests for when you are using the phone in landscape orientation for gaming or videos, but they
will be a target for many laughs either way. And the battery capacity could have been improved a bit,
but we are yet to see the new A13 chip in action, so let's not judge just yet.`}
        ],
        "reviewAuthor": "Marques Brownlee",
        "reviewYoutubeUrl": "https://www.youtube.com/watch?v=aXfiyuUziY0",
        "ratings": [5, 4, 3, 2],
        "experiences": [{
          "id": 123,
          'authorName': 'Laki2003',
          "tekst": "sdhnedthjetj",
          "likes": 25,
          "dislikes": 12,
          "replies":
            [
              {
                "id": 156,
                "author": "Miki2003",
                "text": "egwresdgerhtrjyj",
                "likes": "11",
                "dislikes": "12"
              }
            ]
        }
        ]
      }
    },
    {
      "_id": 8522,
      "basicData": {
        "brend": "Apple",
        "model": "Iphone 11",
        "phoneImage": 'https://fdn2.gsmarena.com/vv/bigpic/apple-iphone-11.jpg',
        "price": 700
      },
      "characteristics": {
        "launch": {
          "announced": "2019, September 20",
          "realased": "Available. Released 2019, September 20"
        },
        "body": {
          "type": "Liquid Retina IPS LCD, 625 nits (typ)",
          "size": 6.1,
          "resolution": "828x1792",
          "protection": "Scratch-resistant glass, oleophobic coating"
        },
        "platform": {
          "OS": "iOS 13, upgradable to iOS 14",
          "Chipset": "Apple A13 Bionic (7 nm+)",
          "cpu": "Hexa-core (2x2.65 GHz Lightning + 4x1.8 GHz Thunder)",
          "gpu": "Apple GPU (4-core graphics)"
        },
        "memory": {
          "rom": [64, 128, 256],
          "ram": 4
        },
        "camera": {
          "MP": 12,
          "p": 2160
        },
        "battery": {
          "number": 2160,
          "material": "Li-on"
        }
      },
      "review": {
        "reviewText": [
          {
            "heading": "Iphone 11 Review",
            "text": `The iPhone XR was the first commercial success that came on the second attempt for making a more
affordable iPhone. The iPhone 5c failed to impress in 2013, and we thought we'd never see the maker
give
this idea another try. Well, last year the iPhone XR was more than well received being the best
selling
iPhone of the trio, so this year we welcome its sequel - the iPhone 11.The iPhone XR was indeed a
cheaper, toned-down version of the XS generation, with an LCD screen, one camera short, and promised
some excellent battery endurance. Well, when we say cheaper, we are not saying cheap, as those words
mean something different in Apple's universe.

But truth be told, this year the iPhone 11 is even cheaper than the XR on launch - now priced at
$700
instead of $750. The good news is that nothing has been left out and there are a few welcome
additions
to the low-tier iPhone.

So, the iPhone 11 keeps absolutely the same form factor and screen as the XR's. It employs the same
6.1"
IPS LCD screen with 326ppi and a notch on top that contains the Face ID tech. The screen specs are
unchanged - same contrast, brightness, Haptic Touch, and whatnot.

The iPhone 11 boasts the new Apple A13 Bionic chip - the same SoC that powers the flagship iPhone 11
Pro
duo. It also gets a second camera, and it's the new 12MP ultra wide-angle snapper, also brought from
the
Pro models. Features like Crop Out of Frame are available as well, and also shooting 4K videos with
all
cameras at once.
The new 12MP selfie camera has made it to the iPhone 11, too. It's another 12MP shooter with 23mm
wide
lens, and it can do regular 4K clips at 60fps, or 4K at 30fps videos with expanded dynamic range.
Cinematic stabilization is available on the front cam on all modes.

Apple managed to squeeze a larger battery in the same body as last year - now the iPhone 11 gets a
3,110mAh battery compared to 2,942mAh unit within the XR.

The iPhone 11 supports 18W charging, but it is not bundled with a fast charger in the box as the Pro
models.

So, a new camera and new chip, among some new cool software tricks, are what's new in the iPhone 11
over
the XR. Oh, and Apple is offering the 11 in some new colors like Green and Purple (the latter we
have
here for review).The iPhone 11 also brings better water protection and may or may not have tougher
glass
on its back and front. We guess only time and drop accidents will confirm the latter.`}
        ],
        "reviewAuthor": "Marques Brownlee",
        "reviewYoutubeUrl": "https://www.youtube.com/watch?v=OoY7zp8GkLI",
        "ratings": [5, 5, 5, 5],
        "experiences": [{
          "id": 352,
          'authorName': 'Lazar Polovina',
          "tekst": `It is great
          phonesrgedtrhrtjryktulktukyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy`,
          "likes": 11,
          "dislikes": 5,
          "replies":
            [
              {
                "id": 777,
                "author": "Milan Polovina",
                "text": `It is great
                phonesrgedtrhrtjryktulktukyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy`,
                "likes": "11",
                "dislikes": "12"
              }
            ]
        }
        ]
      }
    },
    {
      "_id": 4512,
      "basicData": {
        "brend": "Samsung",
        "model": "Galaxy Note 20",
        "phoneImage": 'https://fdn2.gsmarena.com/vv/bigpic/samsung-galaxy-note20-5g-r.jpg',
        "price": 1200
      },
      "characteristics": {
        "launch": {
          "announced": "2020, August 05",
          "realased": "Available. Released 2020, August 21"
        },
        "body": {
          "type": "Super AMOLED Plus, HDR10+",
          "size": 6.7,
          "resolution": "1080x2400",
          "protection": "Corning Gorilla Glass 5"
        },
        "platform": {
          "OS": "Android 10, One UI 2.5",
          "Chipset": "Exynos 990 (7 nm+)",
          "cpu": "Octa-core (2x2.73 GHz Mongoose M5 & 2x2.50 GHz Cortex-A76 & 4x2.0 GHz Cortex-A55)",
          "gpu": "Mali-G77 MP11"
        },
        "memory": {
          "rom": [256],
          "ram": 8
        },
        "camera": {
          "MP": 12,
          "p": 2160
        },
        "battery": {
          "number": 2160,
          "material": "Li-on"
        }
      },
      "review": {
        "reviewText": [
          {
            "heading": "Samsung Galaxy Note 20",
            "text": `The Galaxy Note20 series is finally official. Samsung introduced the Note20 and Note20 Ultra last night
            and now we're going hands-on with the ultimate S-Pen-packing Galaxy for 2020.Similarly to the S20 family
            from the spring, the Ultra comes with exclusive all-out hardware not available on the vanilla model. In
            a somewhat bizarre turn of events that includes the 120Hz 1440p+ display, while the Note20 has a plain
            60Hz 1080p panel. Earlier this year even the smaller S20 had the high refresh rate and the extra pixels.

            The Galaxy Note20 Ultra retains exclusivity on some of the camera bits too. The periscope telephoto, is
            something you won't be able to get on the Note20, though it's a different module than the one on the S20
            Ultra. For zooming in, the Note20 has the same 64MP non-telephoto telephoto that stirred some
            controversy on the S20 and S20+ for the way it was marketed.

            The 108MP Nonacell primary cam is also an Ultra-only feature and this appears to have been carried over
            from the S20 Ultra. Same thing with the smaller Note's 12MP main shooter that you can find on the S20
            and S20+.The Ultra is protected by the brand new Gorilla Glass Victus front and back and both phones get
            a stainless steel frame - that's a first on a Samsung smartphone. Oddly enough, the Note20 comes with a
            plastic back - that one we hadn't seen in a while on a high-end Samsung handset.

            Both Notes get the S Pen too, at least this much is still guaranteed. It's been moved to the left of the
            phone now, a major change from all previous generations. It comes with added gestures and it's got
            improved latency for an even more pen-on-paper-like feel - on the Ultra, that is, the vanilla model
            doesn't get that either.`}
        ],
        "reviewAuthor": "Marques Brownlee",
        "reviewYoutubeUrl": "https://www.youtube.com/watch?v=Exk34o-MMIE",
        "ratings": [3, 2, 1, 4],
        "experiences": [{
          "id": 352,
          'authorName': 'gaga741',
          "tekst": "fgffwrsgherwtjhg",
          "likes": 77,
          "dislikes": 65,
          "replies":
            [
              {
                "id": 777,
                "author": "Deni568",
                "text": "egwresdgerhdsgfhgtrjyjadgsrfjh",
                "likes": "11",
                "dislikes": "12"
              }
            ]
        },
        {
          "id": 111,
          'authorName': 'Lazar Polovina',
          "tekst": "Jako dobreodasasasasasaaaaaaaaaaaaaaaaaaaa",
          "likes": 77,
          "dislikes": 77,
          "replies":
            [
              {
                "id": 777,
                "author": "Deni568",
                "text": "egwresdgerhdsgfhgtrjyjadgsrfjh",
                "likes": "11",
                "dislikes": "12"
              },
              {
                "id": 444,
                "author": "gari512",
                "text": "Odjebi",
                "likes": "11",
                "dislikes": "12"
              }
            ]
        }
        ]
      }
    }
  ]
var _id;
function replyButton(id) {
  if ($(`#${id}comment`).hasClass('reply-form-div-visible')) {
    $(`#${id}comment`).removeClass('reply-form-div-visible')
  } else {
    $(`#${id}comment`).addClass('reply-form-div-visible')
  }
}
function addReply(i) {
  var index = getIndex();
  var length = phones[index].review.experiences[i].replies.length;
  phones[index].review.experiences[i].replies.push({
    id: parseInt(`${index}${i}${length}`),
    text: $(`#${phones[index].review.experiences[i].id}reply-text-input`).val(),
    author: $(`#${phones[index].review.experiences[i].id}reply-name-input`).val(),
    likes: 0,
    dislikes: 0
  })
  console.log(phones[index].review.experiences[i].replies);
  paraf = phones[index].review.experiences[i].replies[length].author.substring(0, 2);
  var reply = `<div class="reply-content">
<div class="reply-header">
    <h2>${paraf}</h2>
</div>
<div class="reply-text">
    <p>${phones[index].review.experiences[i].replies[length].author}</p>
    <p>${phones[index].review.experiences[i].replies[length].text}</p>
    <button class="comment-button" id="like" onclick="liker(${i}, ${length})"><i class="fas fa-thumbs-up"></i></button><span id="${phones[index].review.experiences[i].replies[length].id}rlikes">${phones[index].review.experiences[i].replies[length].likes}</span>
    <button class="comment-button" id="dislike" onclick="disliker(${i}, ${length})"><i class="fas fa-thumbs-down"></i></button><span id="${phones[index].review.experiences[i].replies[length].id}rdislikes">${phones[index].review.experiences[i].replies[length].dislikes}</span>
    <button class="comment-button" id="reply" onclick="replyButton(${phones[index].review.experiences[i].id})"><i class="fas fa-reply"></i></button>
</div>

</div>`

  document.getElementById(`${phones[index].review.experiences[i].id}comment`).insertAdjacentHTML('beforebegin', reply);
}
function addComment() {

  var index = getIndex();
  var length = phones[index].review.experiences.length;
  phones[index].review.experiences.push({
    id: parseInt(`${index}${length}`),
    tekst: $("#comment-text-input").val(),
    authorName: $("#comment-name-input").val(),
    likes: 0,
    dislikes: 0,
    replies: []
  })
  console.log(phones[index].review.experiences);
  paraf = phones[index].review.experiences[length].authorName.substring(0, 2);
  var comment = `<div class="comment-content">
<div class="comment-header comment-div">
    <h2>${paraf}</h2>
</div>
<div class="comment-div">
    <div class="comment-text">
        <p>${phones[index].review.experiences[length].authorName}</p>
        <p>${phones[index].review.experiences[length].tekst}</p>
        <button class="comment-button" id="like" onclick="like(${phones[index].review.experiences[length].id})"><i class="fas fa-thumbs-up"></i></button><span id="${phones[index].review.experiences[length].id}likes">${phones[index].review.experiences[length].likes}</span>
        <button class="comment-button" id="dislike" onclick="dislike(${phones[index].review.experiences[length].id})"><i class="fas fa-thumbs-down"></i></button><span id="${phones[index].review.experiences[length].id}dislikes">${phones[index].review.experiences[length].dislikes}</span>
        <button class="comment-button" id="reply" onclick="replyButton(${phones[index].review.experiences[length].id})"><i class="fas fa-reply"></i></button></span>
        <p id="view-reply">${phones[index].review.experiences[length].replies.length} odgovora</p>
    </div>`

  comment += `<div class="reply-form-div" id="${phones[index].review.experiences[length].id}comment">
  <h2>Dodajte odgovor</h2>
  <form class="reply-form">
      <div class="form-input">
          <label for="name">Ime</label>
          <input type="text" name="name" id="${phones[index].review.experiences[length].id}reply-name-input">
      </div>
      <div class="form-input">
          <label for="text">Vas Komentar</label>
          <textarea name="text" id="${phones[index].review.experiences[length].id}reply-text-input"></textarea>
      </div>
      <button type="button" id="add-comment-btn" onclick="addReply(${length})">Dodaj komentar</button>
  </form>
  </div>
  </div></div>`
  document.getElementById('comments').insertAdjacentHTML('afterbegin', comment);
}
function liker(i, j) {
  index = getIndex();
  var likespan = `${phones[index].review.experiences[i].replies[j].id}rlikes`;
  var dislikespan = `${phones[index].review.experiences[i].replies[j].id}rdislikes`
  if (!$(`#${likespan}`).hasClass('liked')) {
    ++phones[index].review.experiences[i].replies[j].likes;
    document.getElementById(likespan).innerHTML = phones[index].review.experiences[i].replies[j].likes;
    console.log(phones[index].review.experiences[i].replies[j].likes - phones[index].review.experiences[i].replies[j].dislikes);
    $(`#${likespan}`).addClass('liked')
    if ($(`#${dislikespan}`).hasClass('liked')) {
      --phones[index].review.experiences[i].replies[j].dislikes;
      document.getElementById(dislikespan).innerHTML = phones[index].review.experiences[i].replies[j].dislikes;
      $(`#${dislikespan}`).removeClass('liked')
    }
  } else {
    --phones[index].review.experiences[i].replies[j].likes;
    document.getElementById(likespan).innerHTML = phones[index].review.experiences[i].replies[j].likes;
    $(`#${likespan}`).removeClass('liked')
  }

}
function like(id) {
  var likespan = `${id}likes`;
  index = getIndex();
  var i = phones[index].review.experiences.findIndex(comment => { return comment.id == id });
  if (!$(`#${likespan}`).hasClass('liked')) {
    ++phones[index].review.experiences[i].likes;
    document.getElementById(likespan).innerHTML = phones[index].review.experiences[i].likes;
    $(`#${likespan}`).addClass('liked')
    var dislikespan = `${id}dislikes`;
    if ($(`#${dislikespan}`).hasClass('liked')) {
      --phones[index].review.experiences[i].dislikes
      document.getElementById(dislikespan).innerHTML = phones[index].review.experiences[i].dislikes;
      $(`#${dislikespan}`).removeClass('liked')
    }
  } else {
    --phones[index].review.experiences[i].likes;
    document.getElementById(likespan).innerHTML = phones[index].review.experiences[i].likes;
    $(`#${likespan}`).removeClass('liked')
  }
}
function disliker(i, j) {
  index = getIndex();
  var dislikespan = `${phones[index].review.experiences[i].replies[j].id}rdislikes`;
  var likespan = `${phones[index].review.experiences[i].replies[j].id}rlikes`;
  if (!$(`#${dislikespan}`).hasClass('liked')) {
    ++phones[index].review.experiences[i].replies[j].dislikes;
    document.getElementById(dislikespan).innerHTML = phones[index].review.experiences[i].replies[j].dislikes;
    $(`#${dislikespan}`).addClass('liked')
    if ($(`#${likespan}`).hasClass('liked')) {
      --phones[index].review.experiences[i].replies[j].likes;
      document.getElementById(likespan).innerHTML = phones[index].review.experiences[i].replies[j].likes;
      $(`#${likespan}`).removeClass('liked')
    }
  } else {
    --phones[index].review.experiences[i].replies[j].dislikes;
    document.getElementById(dislikespan).innerHTML = phones[index].review.experiences[i].replies[j].dislikes;
    $(`#${dislikespan}`).removeClass('liked')
  }

  console.log(phones[index].review.experiences[i].replies[j].likes - phones[index].review.experiences[i].replies[j].dislikes);

}
function dislike(id) {
  var dislikespan = `${id}dislikes`;
  var likespan = `${id}likes`;
  index = getIndex();
  var i = phones[index].review.experiences.findIndex(comment => { return comment.id == id });
  if (!$(`#${dislikespan}`).hasClass('liked')) {
    ++phones[index].review.experiences[i].dislikes
    document.getElementById(dislikespan).innerHTML = phones[index].review.experiences[i].dislikes;
    $(`#${dislikespan}`).addClass('liked')
    if ($(`#${likespan}`).hasClass('liked')) {
      --phones[index].review.experiences[i].likes;
      document.getElementById(likespan).innerHTML = phones[index].review.experiences[i].likes;
      $(`#${likespan}`).removeClass('liked')
    }
  } else {
    --phones[index].review.experiences[i].dislikes
    document.getElementById(dislikespan).innerHTML = phones[index].review.experiences[i].dislikes;
    $(`#${dislikespan}`).removeClass('liked')
  }

  console.log(phones[index].review.experiences[i].likes - phones[index].review.experiences[i].dislikes);
}
function getAverage() {
  var average = 0;
  var index = getIndex();
  for (i = 0; i < phones[index].review.ratings.length; ++i) {
    average += phones[index].review.ratings[i];
  }
  average = average / phones[index].review.ratings.length;
  return average;
}
function likesMinusDislikes(a, b) {
  return a - b;
}
function sortComments() {

  var index = getIndex();
  var sortArr = phones[index].review.experiences;
  sortArr.sort((comment1, comment2) => { return (comment2.likes - comment2.dislikes) - (comment1.likes - comment1.dislikes) });
  var comments = '';
  for (i = 0; i < sortArr.length; ++i) {
    paraf = sortArr[i].authorName.substring(0, 2);
    comments += `<div class="comment-content" >
<div class="comment-header comment-div">
<h2>${paraf}</h2>
</div>
<div class="comment-div">
<div class="comment-text">
    <p>${sortArr[i].authorName}</p>
    <p>${sortArr[i].tekst}</p>
    <button class="comment-button" id="like" onclick="like(${sortArr[i].id})"><i class="fas fa-thumbs-up"></i></button><span id="${sortArr[i].id}likes">${sortArr[i].likes}</span>
    <button class="comment-button" id="dislike" onclick="dislike(${sortArr[i].id})"><i class="fas fa-thumbs-down"></i></button><span id="${sortArr[i].id}dislikes">${sortArr[i].dislikes}</span>
    <button class="comment-button" id="reply" onclick="replyButton(${sortArr[i].id})"><i class="fas fa-reply"></i></button></span>
    <p id="view-reply">${sortArr[i].replies.length} odgovora</p>
</div>`
    for (j = 0; j < sortArr[i].replies.length; ++j) {
      replyparaf = sortArr[i].replies[j].text.substring(0, 2);
      comments += ` <div class="reply-content">
<div class="reply-header">
    <h2>${replyparaf}</h2>
</div>
<div class="reply-text">
    <p>${sortArr[i].replies[j].author}</p>
    <p>${sortArr[i].replies[j].text}</p>
    <button class="comment-button" id="like" onclick="liker(${i}, ${j})"><i class="fas fa-thumbs-up"></i></button><span id="${sortArr[i].replies[j].id}rlikes">${sortArr[i].replies[j].likes}</span>
    <button class="comment-button" id="dislike" onclick="disliker(${i}, ${j})"><i class="fas fa-thumbs-down"></i></button><span id="${sortArr[i].replies[j].id}rdislikes">${sortArr[i].replies[j].dislikes}</span>
    <button class="comment-button" id="reply" onclick="replyButton(${sortArr[i].id})"><i class="fas fa-reply"></i></button>
</div>

</div>`
    }
    comments += `<div class="reply-form-div" id='${sortArr[i].id}comment'>
    <h2>Dodajte odgovor</h2>
    <form class="reply-form">
        <div class="form-input">
            <label for="name">Ime</label>
            <input type="text" name="name" id="${sortArr[i].id}reply-name-input">
        </div>
        <div class="form-input">
            <label for="text">Vas Komentar</label>
            <textarea name="text" id="${sortArr[i].id}reply-text-input"></textarea>
        </div>
        <button type="button" id="add-comment-btn" onclick="addReply(${i})">Dodaj komentar</button>
    </form></div>
</div>
</div>`;
  }
  document.getElementById('comments').innerHTML = comments;

}

function phone(e) {
  _id = e.parentElement.id;
  console.log(_id);
  location.href = `./phone.html#${_id}`;
}
function ratePhone(e) {
  index = getIndex();
  var number = parseInt(e.getAttribute('value'));
  if(!$('#yourmark').hasClass('yourRate-visible')){
  phones[index].review.ratings[phones[index].review.ratings.length] = number;
  console.log(`${getAverage()} [${phones[index].review.ratings}] ${phones[index].review.ratings.length}`);
  var average = getAverage()
  
  document.getElementById("average").innerHTML = average.toFixed(2);
  document.getElementById('rate-length').innerHTML = phones[index].review.ratings.length;
  document.getElementById("yourmark").innerHTML = `Vasa ocena: ${number}`
  $('#yourmark').addClass('yourRate-visible')
  } else if(!($('#warning').length>0)){
    document.getElementById("yourmark").insertAdjacentHTML('beforebegin', `<p id="warning">Vec ste ocenili ovaj telefon!</p>`);
  }

  $("#star1").removeClass('checked');
  $("#star2").removeClass('checked');
  $("#star3").removeClass('checked');
  $("#star4").removeClass('checked');
  $("#star5").removeClass('checked');
  getAverage() >= 0.5 ? $("#star1").addClass('checked') : $("#star1").removeClass('checked');
  getAverage() >= 1.5 ? $("#star2").addClass('checked') : $("#star2").removeClass('checked');
  getAverage() >= 2.5 ? $("#star3").addClass('checked') : $("#star3").removeClass('checked');
  getAverage() >= 3.5 ? $("#star4").addClass('checked') : $("#star4").removeClass('checked');
  getAverage() >= 4.5 ? $("#star5").addClass('checked') : $("#star5").removeClass('checked');
}
setTimeout(function () {
  $('.loader_bg').fadeToggle();
}, 2000);

function scrollFunction() {
  if (window.innerWidth > 750) {
    window.onscroll = function () {
      if ($(document).scrollTop() > $('.search').height()) {
        $('.normal-header').addClass('white-header');
        $(".nav-header").addClass('nav-header-blue');
        $('.nav-tab .fas').css({ color: 'white' });
        $('.nav-tabs').css({ color: 'rgb(91,197,255)' });
        $('.nav-tab').hover(function () { $(this).find('.fas').css({ color: 'rgb(91,197,255)' }); },
          function () { $(this).find('.fas').css({ color: 'white' }) });

      } else {
        $('.normal-header').removeClass('white-header');
        $(".nav-header").removeClass('nav-header-blue');
        $('.nav-tab').hover(function () { $(this).find('.fas').css({ color: 'white' }); },
          function () { $(this).find('.fas').css({ color: 'rgb(91,197,255)' }) });
        $('.nav-tabs').css({ color: 'white' });
        $('.nav-tab .fas').css({ color: 'rgb(91,197,255)' });

      }

    }

  } else {
    $('.normal-header').removeClass('white-header');
    $(".nav-header").removeClass('nav-header-blue');
    $('.nav-tabs').css({ color: 'white' });
    $('.nav-tab .fas').css({ color: 'rgb(91,197,255)' });
    $('.nav-tab').hover(function () { $(this).find('.fas').css({ color: 'white' }); },
      function () { $(this).find('.fas').css({ color: 'rgb(91,197,255)' }) });

    window.onscroll = null;

  }
}
$(document).ready(function () {
  scrollFunction();
  var phoneDiv = ``;
  if (location.href.indexOf('index') > -1) {
    for (i = 0; i < phones.length; ++i) {
      phoneDiv += `<div class="phone-div" id=${phones[i]._id}>
   <h5>${phones[i].basicData.brend}  ${phones[i].basicData.model}</h5>
   <h5>${phones[i].basicData.price}$</h5>
   <img src=${phones[i].basicData.phoneImage} width="100%" height="250px">
   <button class="details-button" onclick="phone(this)" >Details</button></div>`}
    document.getElementById('news').insertAdjacentHTML('afterbegin', phoneDiv);
  }
  else if (location.href.indexOf('phone') > -1) {
    index = getIndex();
    console.log(index);
    var memory = ``;
    for (i = 0; i < phones[index].characteristics.memory.rom.length; ++i) {
      memory += `${phones[index].characteristics.memory.rom[i]}GB ${phones[index].characteristics.memory.ram}RAM `;
    }
    var youtubeUrl = 'https://www.youtube.com/embed/' + youtube_parser(phones[index].review.reviewYoutubeUrl);
    var average = getAverage();
    var comments = ``;
    for (i = 0; i < phones[index].review.experiences.length; ++i) {
      paraf = phones[index].review.experiences[i].authorName.substring(0, 2);
      comments += `<div class="comment-content">
<div class="comment-header comment-div">
    <h2>${paraf}</h2>
</div>
<div class="comment-div">
    <div class="comment-text">
        <p>${phones[index].review.experiences[i].authorName}</p>
        <p>${phones[index].review.experiences[i].tekst}</p>
        <button class="comment-button" id="like" onclick="like(${phones[index].review.experiences[i].id})"><i class="fas fa-thumbs-up"></i></button><span id="${phones[index].review.experiences[i].id}likes">${phones[index].review.experiences[i].likes}</span>
        <button class="comment-button" id="dislike" onclick="dislike(${phones[index].review.experiences[i].id})"><i class="fas fa-thumbs-down"></i></button><span id="${phones[index].review.experiences[i].id}dislikes">${phones[index].review.experiences[i].dislikes}</span>
        <button class="comment-button" id="reply" onclick="replyButton(${phones[index].review.experiences[i].id})"><i class="fas fa-reply"></i></button></span>
        <p id="view-reply">${phones[index].review.experiences[i].replies.length} odgovora</p>
    </div>`
      for (j = 0; j < phones[index].review.experiences[i].replies.length; ++j) {
        replyparaf = phones[index].review.experiences[i].replies[j].text.substring(0, 2);
        comments += ` <div class="reply-content">
    <div class="reply-header">
        <h2>${replyparaf}</h2>
    </div>
    <div class="reply-text">
        <p>${phones[index].review.experiences[i].replies[j].author}</p>
        <p>${phones[index].review.experiences[i].replies[j].text}</p>
        <button class="comment-button" id="like" onclick="liker(${i}, ${j})"><i class="fas fa-thumbs-up"></i></button><span id="${phones[index].review.experiences[i].replies[j].id}rlikes">${phones[index].review.experiences[i].replies[j].likes}</span>
        <button class="comment-button" id="dislike" onclick="disliker(${i}, ${j})"><i class="fas fa-thumbs-down"></i></button><span id="${phones[index].review.experiences[i].replies[j].id}rdislikes">${phones[index].review.experiences[i].replies[j].dislikes}</span>
        <button class="comment-button" id="reply" onclick="replyButton(${phones[index].review.experiences[i].id})"><i class="fas fa-reply"></i></button>
    </div>

</div>`
      }
      comments += `<div class="reply-form-div" id="${phones[index].review.experiences[i].id}comment">
      <h2>Dodajte odgovor</h2>
      <form class="reply-form">
          <div class="form-input">
              <label for="name">Ime</label>
              <input type="text" name="name" id="${phones[index].review.experiences[i].id}reply-name-input">
          </div>
          <div class="form-input">
              <label for="text">Vas Komentar</label>
              <textarea name="text" id="${phones[index].review.experiences[i].id}reply-text-input"></textarea>
          </div>
          <button type="button" id="add-comment-btn" onclick="addReply(${i})">Dodaj komentar</button>
      </form> </div>
</div>
    </div>`;
    }
    phoneDiv = `<div class="phone-h2-div">
    <h2>${phones[index].basicData.brend} ${phones[index].basicData.model}</h2>
</div>
<div class="general-specs">
    <div class="general-specs-img"><img src=${phones[index].basicData.phoneImage}
            height="auto"></div>
    <div class="general-specs-text">
        <div class="general-spec-text"><i class="fas fa-tablet-alt"></i>
            <h2>${phones[index].characteristics.body.size}"</h2>
            <p>${phones[index].characteristics.body.resolution}</p>
        </div>
        <div class="general-spec-text"><i class="fas fa-camera"></i>
            <h2>${phones[index].characteristics.camera.MP}MP</h2>
            <p>${phones[index].characteristics.camera.p}p</p>
        </div>
        <div class="general-spec-text">
            <i class="fas fa-microchip"></i>
            <h2>${phones[index].characteristics.memory.ram}RAM</h2>
            <p>${phones[index].characteristics.platform.Chipset}</p>
        </div>
        <div class="general-spec-text">
            <i class="fas fa-battery-full"></i>
            <h2>${phones[index].characteristics.battery.number}mAH</h2>
            <p>${phones[index].characteristics.battery.material}</p>
        </div>
        <div class="general-spec-text">
            <i class="fas fa-dollar-sign"></i>
            <h2>${phones[index].basicData.price}</h2>
            <p>dolara</p>
        </div>

    </div>
</div>
<div class="review">
    <h2>${phones[index].review.reviewText[0].heading}</h2>
    <div class='review-text'>
        <p>${phones[index].review.reviewText[0].text}</p>
    </div><span class="heading">User Rating</span><span class="rating">
    <span id="star1" class="fa fa-star ${getAverage() >= 0.5 ? 'checked' : ""}" onclick="ratePhone(this)" value="1"></span>
    <span id="star2" class="fa fa-star ${getAverage() >= 1.5 ? 'checked' : ""}" onclick="ratePhone(this)" value="2"></span>
    <span id="star3" class="fa fa-star ${getAverage() >= 2.5 ? 'checked' : ""}"  onclick="ratePhone(this)" value="3"></span>
    <span id="star4" class="fa fa-star ${getAverage() >= 3.5 ? 'checked' : ""}" onclick="ratePhone(this)" value="4"></span>
    <span id="star5" class="fa fa-star ${getAverage() >= 4.5 ? 'checked' : ""}" onclick="ratePhone(this)" value="5"></span>
    <p id="yourmark" class="yourRate"></p>
    <p><span id="average">${getAverage()}</span> bazirana na  <span id="rate-length">${phones[index].review.ratings.length}</span> odgovora.</p>
    <iframe width="600" height="400" style="border:none" src=${youtubeUrl}
        allowfullscreen id="youtubevideo">
    </iframe>
</div>
<div class="spec-table">
    <table>
        <tbody>
            <th class="table-header">Specifications</th>
            <tr>
                <td class="table-row"><b>Launch</b></td>
                <td class='table-row'>
                    <ul class="table-list">
                        <li>Announced</li>
                        <li>Realased</li>
                    </ul>
                </td>
                <td class='table-row'>
                    <ul class="table-list">
                        <li>${phones[index].characteristics.launch.announced}</li>
                        <li>${phones[index].characteristics.launch.realased}</li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td class="table-row"><b>Body</b></td>
                <td class='table-row'>
                    <ul class="table-list">
                        <li>Type</li>
                        <li>Size</li>
                        <li>Resolution</li>
                        <li>Protection</li>
                    </ul>
                </td>
                <td class='table-row'>
                    <ul class="table-list">
                        <li>${phones[index].characteristics.body.type}</li>
                        <li>${phones[index].characteristics.body.size} inches, ${phones[index].characteristics.body.size * 2.5} </li>
                        <li>${phones[index].characteristics.body.resolution}</li>
                        <li>${phones[index].characteristics.body.protection}</li>
                    </ul>
                </td>
            </tr>
            <td class="table-row"><b>Platform</b></td>
            <td class='table-row'>
                <ul class="table-list">
                    <li>OS</li>
                    <li>Chipset</li>
                    <li>CPU</li>
                    <li>GPU</li>
                </ul>
            </td>
            <td class='table-row'>
                <ul class="table-list">
                    <li>${phones[index].characteristics.platform.OS}</li>
                    <li>${phones[index].characteristics.platform.Chipset}</li>
                    <li>${phones[index].characteristics.platform.cpu}</li>
                    <li>${phones[index].characteristics.platform.gpu}</li>
                </ul>
            </td>
            </tr>
            <tr>
                <td class="table-row"><b>Memory</b></td>
                <td class='table-row'>
                    Internal
                </td>
                <td class='table-row'>
                ${memory}
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div id="comment">
   <h2>Komentari  <i class="fas fa-sort" onclick=sortComments()></i></h2>
  <div id="comments"> ${comments} </div>
    <h2>Dodajte komentar</h2>
    <form class="comment-form">
        <div class="form-input">
            <label for="name">Ime</label>
            <input type="text" name="name" id="comment-name-input">
        </div>
        <div class="form-input">
            <label for="text">Vas Komentar</label>
            <textarea name="text" id="comment-text-input"></textarea>
        </div>
        <button type="button" id="add-comment-btn" onclick="addComment()">Dodaj komentar</button>
    </form>
</div>

`
    document.getElementById('phone-general').insertAdjacentHTML('afterbegin', phoneDiv);

    $("#star1").hover(function () {
      $("#star1").removeClass('checked');
      $("#star2").removeClass('checked');
      $("#star3").removeClass('checked');
      $("#star4").removeClass('checked');
      $("#star5").removeClass('checked');
      $("#star1").addClass('checked');

    }, function () {
      if (getAverage() < 0.5) {
        $("#star1").removeClass('checked');
      }
      if (getAverage() >= 1.5) {
        $("#star2").addClass('checked');
      }
      if (getAverage() >= 2.5) {
        $("#star3").addClass('checked');
      }
      if (getAverage() >= 3.5) {
        $("#star4").addClass('checked');
      }
      if (getAverage() >= 4.5) {
        $("#star5").addClass('checked');
      }
    })

    $("#star2").hover(function () {
      $("#star1").removeClass('checked');
      $("#star2").removeClass('checked');
      $("#star3").removeClass('checked');
      $("#star4").removeClass('checked');
      $("#star5").removeClass('checked');
      $("#star1").addClass('checked');
      $("#star2").addClass('checked');

    }, function () {
      if (getAverage() < 0.5) {
        $("#star1").removeClass('checked');
      }
      if (getAverage() < 1.5) {
        $("#star2").removeClass('checked');
      }
      if (getAverage() >= 2.5) {
        $("#star3").addClass('checked');
      }
      if (getAverage() >= 3.5) {
        $("#star4").addClass('checked');
      }
      if (getAverage() >= 4.5) {
        $("#star5").addClass('checked');
      }
    })
    $("#star3").hover(function () {
      $("#star1").removeClass('checked');
      $("#star2").removeClass('checked');
      $("#star3").removeClass('checked');
      $("#star4").removeClass('checked');
      $("#star5").removeClass('checked');
      $("#star1").addClass('checked');
      $("#star2").addClass('checked');
      $("#star3").addClass('checked');
    }, function () {
      if (getAverage() < 0.5) {
        $("#star1").removeClass('checked');
      }
      if (getAverage() < 1.5) {
        $("#star2").removeClass('checked');
      }
      if (getAverage() < 2.5) {
        $("#star3").removeClass('checked');
      }
      if (getAverage() >= 3.5) {
        $("#star4").addClass('checked');
      }
      if (getAverage() >= 4.5) {
        $("#star5").addClass('checked');
      }
    })
    $("#star4").hover(function () {
      $("#star1").removeClass('checked');
      $("#star2").removeClass('checked');
      $("#star3").removeClass('checked');
      $("#star4").removeClass('checked');
      $("#star5").removeClass('checked');
      $("#star1").addClass('checked');
      $("#star2").addClass('checked');
      $("#star3").addClass('checked');
      $("#star4").addClass('checked');

    }, function () {
      if (getAverage() < 0.5) {
        $("#star1").removeClass('checked');
      }
      if (getAverage() < 1.5) {
        $("#star2").removeClass('checked');
      }
      if (getAverage() < 2.5) {
        $("#star3").removeClass('checked');
      }
      if (getAverage() < 3.5) {
        $("#star4").removeClass('checked');
      }
      if (getAverage() >= 4.5) {
        $("#star5").addClass('checked');
      }
    })
    $("#star5").hover(function () {
      $("#star1").removeClass('checked');
      $("#star2").removeClass('checked');
      $("#star3").removeClass('checked');
      $("#star4").removeClass('checked');
      $("#star5").removeClass('checked');
      $("#star1").addClass('checked');
      $("#star2").addClass('checked');
      $("#star3").addClass('checked');
      $("#star4").addClass('checked');
      $("#star5").addClass('checked');

    }, function () {
      if (getAverage() < 0.5) {
        $("#star1").removeClass('checked');
      }
      if (getAverage() < 1.5) {
        $("#star2").removeClass('checked');
      }
      if (getAverage() < 2.5) {
        $("#star3").removeClass('checked');
      }
      if (getAverage() < 3.5) {
        $("#star4").removeClass('checked');
      }
      if (getAverage() < 4.5) {
        $("#star5").removeClass('checked');
      }
    })

  }
})

$(window).on('resize', function () {
  scrollFunction()
})

$("#menu-bar").click(function () {
  if (e == 0) {

    $("header").addClass("mobil");
    $(".nav-tab").addClass('nav-tab-visible');


    ++e;
  }
  else {
    --e;
    $("header").removeClass('mobil');
    $(".nav-tab").removeClass('nav-tab-visible');


  }
  if ($(".fa-ellipsis-h").hasClass("rotate90") && brojac == 0) {
    $(".fa-ellipsis-h").removeClass("rotate90");
    $(".fa-ellipsis-h").addClass("rotate180");
  }
  else if ($(".fa-ellipsis-h").hasClass("rotate180") && brojac == 0) {
    $(".fa-ellipsis-h").removeClass("rotate180");
    $(".fa-ellipsis-h").addClass("rotate270");
  }
  else if ($(".fa-ellipsis-h").hasClass("rotate270") && brojac == 0) {
    $(".fa-ellipsis-h").removeClass("rotate270");
    $(".fa-ellipsis-h").addClass("rotate360");
    ++brojac;
  }
  else if ($(".fa-ellipsis-h").hasClass("rotate360") && brojac == 1) {
    $(".fa-ellipsis-h").removeClass("rotate360");
    $(".fa-ellipsis-h").addClass("rotate270");
  }
  else if ($(".fa-ellipsis-h").hasClass("rotate270") && brojac == 1) {
    $(".fa-ellipsis-h").removeClass("rotate270");
    $(".fa-ellipsis-h").addClass("rotate180");
  }
  else if ($(".fa-ellipsis-h").hasClass("rotate180") && brojac == 1) {
    $(".fa-ellipsis-h").removeClass("rotate180");
    $(".fa-ellipsis-h").addClass("rotate90");

  }
  else if ($(".fa-ellipsis-h").hasClass("rotate90") && brojac == 1) {
    $(".fa-ellipsis-h").removeClass("rotate90");
    --brojac;
  }
  else {
    $(".fa-ellipsis-h").addClass("rotate90");
  }
})



function youtube_parser(url) {
  var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
  var match = url.match(regExp);
  return (match && match[7].length == 11) ? match[7] : false;

}

function getIndex() {
  url = location.href.toString();
  for (i = 0; i < url.length; ++i) {
    if (url[i] == '#')
      break;
  }
  var _id = url.substring(i + 1, url.length);
  index = phones.findIndex(p => {
    return p._id.toString() == _id;
  });
  return index;
}

